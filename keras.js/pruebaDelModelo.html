<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Keras.js - testModel</title>
<meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=0.7">
<style>
body { text-align: center; font-size: 15pt; font-family: Arial, Helvetica, sans-serif;}
h1 { font-weight: bold; font-size: 25pt; }
h2 { font-weight: bold; font-size: 15pt; }
button { font-weight: bold; font-size: 15pt; }
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script src="https://unpkg.com/keras-js"></script>
<script>

const input_len = 30
const output_len = 5
var pred_in = null;
var pred_out = null;
var model = null

function init()
{
  //cargar modelo
  this.model = new KerasJS.Model({
    filepath: 'car_race_model.bin',
    filesystem: true,
    gpu: true
  })
  this.model.ready()
}

function testModel()
{
  //setear pred_in en 0
  this.pred_in = new Float32Array([.0, .0, .0, .0, .0,
                              .0, .0, .0, .0, .0,
                              .0, .0, .0, .0, .0,
                              .0, .0, .0, .0, .0,
                              .0, .0, .0, .0, .0,
                              .0, .0, .0, .0, .0])
  this.pred_out = new Float32Array([.0, .0, .0, .0, .0])
  //cargar pred_in con los enemigos y el jugador
  //for (var i = 0; i < this.input_len ; i++) {
  //  this.pred_in[i] =
  const inputData = {
    input: this.pred_in
  }
  console.log(inputData);
  console.log(this.pred_out);
  //predict from input
  this.model
  .predict(inputData)
  .then(outputData => {
    this.pred_out = new Float32Array(outputData.output)
    console.log(this.pred_in);
    console.log(this.pred_out);
    $("#out0").text(this.pred_out[0])
    $("#out1").text(this.pred_out[1])
    $("#out2").text(this.pred_out[2])
    $("#out3").text(this.pred_out[3])
    $("#out4").text(this.pred_out[4])
  })
  .catch(err => {
    // handle error
    console.log(err);
  })


}

window.onload = init;
</script>
</head>

<body>
<center>
<h1 id="title"> </h1>
</center>
<h2>
	<button id="bt_test" type="button" onclick="testModel();">TEST</button>
</h2>
<br>
<p>out 0: <span id="out0"></span></p>
<p>out 1: <span id="out1"></span></p>
<p>out 2: <span id="out2"></span></p>
<p>out 3: <span id="out3"></span></p>
<p>out 4: <span id="out4"></span></p>
</body>
</html>
